<html>
<head>
    <title>Money</title>
</head>
<body>
<p><a href="/load/">load</a> | <a href="/admin/">admin</a></p>

<style>
body { font-family: sans-serif; font-size: 90% }
table { font-size: 100% }
th { text-align: left; border-bottom: 1px dotted black }
td { 
    vertical-align: top;
    padding: 0 1em 1em 0;
}
td.amount, th.amount { 
    text-align: right
}
td.amount { font-family: monospace }
.hidden { display: none }
p { margin: 0; padding: 0}
.close, .save { font-size: 80% }
.editable .display { border: 1px solid white }
.editable .display:hover { border: 1px solid black; cursor:pointer }
.note { width: 15em }
</style>     

<table>
     <tr>
         <th>Date</th>
         <th>Memo</th>
         <th class="amount">Amount</th>
         <th>Balance</th>
         <th>Note</th>
         <th>Tags</th>
     </tr>
     {% for transaction in transactions %}
         <tr>
             <td>{{ transaction.date|date:"d F Y" }}</td>
             <td>{{ transaction.memo|linebreaks }}</td>
             <td class="amount">{{ transaction.display_amount }}</td>
             <td class="amount">{{ transaction.display_balance }}</td>
             <td class="note editable">{% include "money/note_snippet.html" %}</td>
             <td class="editable">{% include "money/tags_snippet.html" %}</td>
         </tr>
     {% endfor %}
</table>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script>
(function () {

$('.editable').click(function (e) {
    var that = $(this);
        display = that.find('.display')
    display.hide();
    that.find('.control_container').show();
    that.find('.control').focus().select();
});     

$('.editable .close').live('click', function (e) {
    e.preventDefault();
    e.stopPropagation();
    var editable = $(this).parents('.editable');
    editable.find('.display').show();
    editable.find('.control_container').hide();
});     

$('.editable .save').live('click', function (e) {
    e.preventDefault();
    var editable = $(this).parents('.editable'),
        form = editable.find('form');
    $.post(form.attr('action'), 
           form.serialize(),
           function (snippet) {
               editable.html(snippet);
           })
});     

}());
</script>
</body>
