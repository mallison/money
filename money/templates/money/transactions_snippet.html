{% load money %}
<div id="related">
  <a id="show-all" href="">Show all</a>

  <table>
    <tr><th class="left">in</th><td class="amount">{{ in_and_out.next|pretty_amount }}</td>
      <td><input name="tags" value="in" type="radio"></td>
    </tr>
    <tr><th class="left">out</th><td class="amount">{{ in_and_out.next|pretty_amount }}</td>
      <td><input name="tags" value="out" type="radio"></td>
    </tr>
    {% with total_to_date=in_and_out.next %}
    <tr><th class="left">difference</th><td class="amount">{{ total_to_date|pretty_amount }}</td></tr>
    <tr><th class="left">Estimated remaining balance</th><td class="amount">{{ total_outstanding|add:total_to_date|add:savings_target|pretty_amount }}</td></tr>
  </table>

  <table>
    <caption>Outstanding transactions</caption>
    {% for what, amount in outstanding %}
    <tr><td>{{ what }}</td><td class="amount">{{ amount|pretty_amount }}</td></tr>
    {% endfor %}
    <tr><td>TOTAL</td><td class="amount">{{ total_outstanding|pretty_amount }}</td></tr>
    <tr><td>Estimated difference</td><td class="amount">{{ total_outstanding|add:total_to_date|pretty_amount }}</td></tr>
    <tr><td>Savings target</td><td class="amount">{{ savings_target|pretty_amount }}</td></tr>
    <table>
      {% endwith %}
      <caption>Spending per category</caption>
      {% for tag, total in totals_for_tags %}
      {% if total %}
      <tr class="tag{% if tag = "misc" %} misc{% endif %}">
	<td>
	  <label for="{{ tag }}">{{ tag }}</label>
	</td>
	<td class="amount">
	  <label>{{ total|floatformat:2 }}<input id="{{ tag }}" name="tags" type="radio" value="{{ tag }}" /></label>
	</td>
      </tr>
      {% endif %}
      {% endfor %}
    </table>
</div>
<div id="transactions">
  <table id="transaction-list">
    <tr>
      <th>Date</th>
      <th>Account</th>
      <th>Memo</th>
      <th class="amount">Amount</th>
      <th class="amount">Account balance</th>
      <th class="amount">Total balance</th>
      <th>Note</th>
      <th>Tags</th>
    </tr>
    {% for transaction in transactions %}
    <tr class="{% spaceless %}{% for tag in transaction.tags.all %}{{ tag.name }} {% empty %}misc{% endfor %}{% endspaceless %} {{ transaction.account.name|slugify }} {% if transaction.tags.all.0.name != "transfer" %}{% if transaction.amount < 0 %}out{% else %}in{% endif %}{% endif %}">
      <td>{{ transaction.date|date:"d F Y" }}</td>
      <td>{{ transaction.account.name }}</td>
      <td>{{ transaction.memo|linebreaks }}</td>
      <td class="amount">{{ transaction.amount|pretty_amount }}</td>
      <td class="amount">{{ transaction.account_balance|pretty_amount }}</td>
      <td class="amount">{{ transaction.total_balance|pretty_amount }}</td>
      <td class="note editable">
        {% include "money/note_snippet.html" %}
      </td>
      <td class="editable">
        {% include "money/tags_snippet.html" %}
      </td>
    </tr>
    {% endfor %}
  </table>
</div>
